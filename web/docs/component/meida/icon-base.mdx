---
sidebar_position: 2
title: IconBase 图标基础
---

<ComponentBrief name="IconBase">
  https://www.iconfont.cn 辅助，用于注入 iconfont 或 webfont 并返回对应的 font 名，是写组件的好帮手，同时提供了 `IconBase` 以助理快速写组件。
</ComponentBrief>

## 何时使用

以 `IconBase` 为基，轻松打造项目（或类库）专属的图标集。

## 如何使用

### 第一步：iconfont 项目

你需要新建或使用已有的 [iconfont](https://www.iconfont.cn) 项目，它会有一个固定不变的 `id` 和跟当前内容有关的 `hash`，并且可能有 Base64，都可以拿来，比如：

![Code Example](https://img.alicdn.com/imgextra/i3/O1CN01xQMgKp1syThmNp0Db_!!6000000005835-2-tps-1920-1048.png)

### 第二步：定义组件

参考 `@kcuf-ui/rc-icon` 的实现，核心代码 50 行左右：

```tsx
import {
  ReactElement,
  forwardRef
} from 'react';

import IconBase, {
  IconBaseRef,
  IconPropsGeneric,
  injectIconFont
} from 'kcuf-ui';

const ICON_TYPE_MAPPING = {
  loading: 'e62e',
  close: 'e612'
};

type TIconType = keyof typeof ICON_TYPE_MAPPING;

interface IIconProps extends IconPropsGeneric<TIconType> {}

// https://at.alicdn.com/t/c/font_4720928_yvtln3fv7v.css
const fontFamily = injectIconFont('4720928', 'yvtln3fv7v', { // 每次更新只需更新文件中的 hash 值
  pathExtra: '/c'
});

function getIconCode(type: TIconType) {
  return `\\${ICON_TYPE_MAPPING[type] || 'e600'}`;
}

function getIconColor(type: TIconType): string | null {
  ...
}

function Icon({
  type,
  ...props
}: IIconProps, ref: IconBaseRef): ReactElement {
  return <IconBase<TIconType> {...{
    ref,
    type,
    rotating: type === 'loading',
    ...props,
    fontFamily,
    getIconCode,
    getIconColor
  }} />;
}

export default forwardRef(Icon);

export type {
  IconBaseRef as IconRef,
  TIconType as IconType,
  IIconProps as IconProps
};
```

### 第三步：使用 Icon 组件

```tsx
import Icon from '...'; // 应用内部的或你把它发布成包

// OK
<Icon type="loading" />
<Icon type="close" />
// TS 报错
<Icon type="load" />
<Icon type="x" />
```

## 最佳实践

### 使用 TS

`IconBase` 充分利用了 TS 的泛型，能够帮助我们第一时间在编写代码的时候就能够发现 Icon 的 `type` 可能没有传对，更可以利用 IDE 的自动提示快速找到需要的图标类型。既提升编码效率，又可以避免拼写错误这样的低级错误。

### 切分模块

以上，为了 demo 完整，我特意将代码全部写在了一起。但实际场景建议将类型、常量（可能会很大）、帮助方法等按类型切割模块，最后再汇总进行 `export`。

这样做的好处是可以对代码一目了然，其中 `const/index.ts` 和 `util/get-icon-color.ts` 可能经常需要更新。

一个 Icon 组件模块或库，大概是这样的文件结构：

```text
.
├── const/
│   └── index.ts
├── types/
│   └── index.ts
├── util/
│   ├── get-icon-code.ts
│   ├── get-icon-color.ts
│   └── index.ts
└── index.tsx               # 总 export
```

## 使用 WebFont 字体（TODO 重写）

WebFont 可以让你的页面展现一些设计师希望的「美妙」字体（尤其是中文字体）。

众所周知，中文字体包不像西方字体那样，它很大，不可能为了视觉上的美观而让浏览器加载全量的中文字体包。

iconfont 网站提供了 [webfont](https://www.iconfont.cn/fonts/index) 的功能，你可以根据设计师给的文案去上边「定制」你要的字体。

假设，设计师要展示这样的文案：

![WebFont Example](https://img.alicdn.com/imgextra/i1/O1CN01KKpw4f1mkqDbsPutl_!!6000000004993-2-tps-852-82.png)

### 定义 WebFont 组件

你这么做：

![Copy Id](https://img.alicdn.com/imgextra/i2/O1CN01Ml8SDd238ggwXhb9E_!!6000000007211-2-tps-905-556.png)

```tsx
import {
  ReactElement
} from 'react';
import styled from 'styled-components';

import {
  injectWebFont
} from 'kcuf-ui';

const fontFamily = injectWebFont('kygag0sd8g');

// 如果有其他的样式要求，也可以在这里加，或者在它的容器上加也行
const ScMengziKongzi = styled.span`
  font-family: ${fontFamily}, sans-serif;
`;

export default function MengziKongzi(): ReactElement {
  return <ScMengziKongzi>孔子曰：中午不睡，下午崩溃！孟子曰：孔子说的对！</ScMengziKongzi>;
}
```

### 使用 WebFont 组件

```tsx
import React from 'react';

import MengziKongzi from 'path/to/mengzi-kongzi'; // 一般在引用内部，没有意义发布成包

// 任何需要此组件的地方
<MengziKongzi />
```

## API Reference

### import

```tsx
import {
  IconBase,
  IconBaseRef,
  IconPropsGeneric
} from 'kcuf-ui';

// 也可单包引入
import IconBase, {
  IconBaseRef,
  IconPropsGeneric
} from '@kcuf-ui/rc-icon-base';
```

| Export | 类型 | 说明 |
| --- | :-: | --- |
| `IconBase` | 组件 | 待补充 `type` |
| `IconBaseRef` | 类型 | `Ref` 类型，指向底层的 `<i>` 元素，二次封装时传递给 `forwardRef` 的类型 |
| `IconPropsGeneric<T>` | 类型 | 组件 `props` 类型，二次封装时需将泛型 `T` 实体化 |
| `injectIconFont(projectId: string, hash: string, options?)` | 帮助方法 | 在 `header` 上注入 IconFont 项目生成的 `@font-face` 全局样式，并返回 font-family 名字 |
| `injectWebFont(id: string)` | 帮助方法 | 在 `header` 上注入 IconFont 项目生成的 `@font-face` 全局样式，并返回 font-family 名字 |

### Props

| 属性 | 类型 | 说明 |
| --- | --- | --- |
| `fontFamily` <TagRequired /> | `string` | 图标字体名称，由 `generateFontFamilyForIcon` 生成 |
| `rotating` <TagDefault>false</TagDefault> | `boolean` | 是否让图标一直旋转，一般只用在 Loading 等图标上 |
| `darkThemePrefix` | `string` | `getIconColorDark` 需要用它决定当前项目（或组件库）用的是什么方式判断的暗色主题 |
| `type` <TagRequired /> | `string` | 类型名，决定图标长什么样。尽量使用语义化的名称，比如 `close` 等。一般来说，一个 `type` 对应一个图标的 code，<br />但出于语义化的考量，不同的 `type` 可以对应到同一个 `code`，比如 ✔ 这样的图标，其 `type` 可以是 `success` 和 `check` |
| `disabled` <TagDefault>false</TagDefault> | `boolean` | 是否为禁用状态 |
| `colored` <TagDefault>false</TagDefault> | `boolean` | 是否展示预设的颜色 |
| `rotate` | `number` | 旋转图标，单位为 °，`rotate: 90` 表示顺时针旋转 90°，`rotate: -90` 表示逆时针旋转 90° |
| `scale` | `number` | 若 rotate 后图标的大小可能不令人满意，可以用它矫正，一般情况下不要用 |
| `getIconCode` <TagRequired /> | `(type: T) => string` | 获取 `type` 对应图标的 Unicode 值，e.g. `e600`，建议定义一个 `type-code` 的映射常量 |
| `getIconColor` | `(type: T) => string` | 获取 `type` 对应图标的预设颜色，方便实现一致的视觉效果 |
| `getIconColorDark` | `(type: T) => string` | 有暗色主题时（必须搭配 `darkThemePrefix` 使用），在 `getIconColor` 的基础上，某些对比度不够的颜色可用它修正 |

### Events

`IconBase` 的底层 DOM 元素是 `<i>`，支持其所有 DOM 事件，常用事件为 `onClick`：

| Name | 类型 | 说明 |
| --- | --- | --- |
| `onClick` | `(e: MouseEvent<HTMLSpanElement>) => void` | 为 `Icon` 赋予 `role="button"`、`tabIndex=0` 等额外的按钮特性 |